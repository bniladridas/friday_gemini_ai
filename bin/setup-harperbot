#!/bin/bash

# Setup script for HarperBot Workflow Mode
# Copies required files to the current repository

set -e

echo "Setting up HarperBot for Workflow Mode..."

# Check if we're in a git repository
if ! git rev-parse --git-dir > /dev/null 2>&1; then
    echo "Error: Not in a git repository"
    exit 1
fi

# Get the source repository URL (assuming this script is run from the source repo)
SOURCE_REPO="https://github.com/bniladridas/friday_gemini_ai.git"

# Create temporary directory for cloning
TEMP_DIR=$(mktemp -d)
trap "rm -rf $TEMP_DIR" EXIT

echo "Cloning source repository..."
git clone --depth 1 $SOURCE_REPO $TEMP_DIR

echo "Copying harperbot directory..."
cp -r $TEMP_DIR/harperbot .

echo "Copying GitHub Actions workflow..."
mkdir -p .github/workflows
cp $TEMP_DIR/.github/workflows/codebot.yml .github/workflows/

echo "Setup complete!"
echo ""
echo "Next steps:"
echo "1. Set repository secrets: GEMINI_API_KEY, HARPER_BOT_APP_ID, HARPER_BOT_PRIVATE_KEY"
echo "2. Optional: Configure harperbot/config.yaml"
echo "3. Push changes and test with a PR"
echo ""
echo "For detailed instructions, see harperbot/HarperBot.md"